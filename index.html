<!DOCTYPE html>
<html lang="en" ng-app="Greenhouse" <head>
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Greenhouse</title>
<script src="https://cdn.jsdelivr.net/g/angularjs@1.5.5(angular.min.js+i18n/angular-locale_de-de.js+angular-touch.min.js+angular-sanitize.min.js+angular-route.min.js+angular-resource.min.js+angular-parse-ext.min.js+angular-messages.min.js+angular-message-format.min.js+angular-loader.min.js+angular-cookies.min.js+angular-aria.min.js+angular-animate.min.js),momentjs@2.14.1(moment-with-locales.min.js),chart.js@2.0.2,angular.chartjs@1.0.0,jquery@3.1.0,bootstrap@3.3.7(js/bootstrap.min.js+js/bootstrap.js)"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/g/bootstrap@3.3.7(css/bootstrap.min.css),bootstrap.m8tro@3.3.7">
<style type="text/css">
    .sidebar {
        background-color: #000
    }
</style>
<script>
    angular.module('apiService', ['ngResource']).factory('Measurement', ['$resource',
        function($resource) {
            return $resource('http://localhost:6060/measurements', {}, {
                query: {
                    method: 'GET',
                    isArray: false
                }
            });
        }
    ]);
    var Greenhouse = angular.module('Greenhouse', ['chart.js', 'apiService']);
    Greenhouse.controller("HistogramCtrl", function($scope, Measurement) {

        $scope.measurementData = Measurement.query({}, function() {
            $scope.enableHistogram()
        });

        $scope.measurementToChartData = function(query) {
            $scope.luxChart = {
                series: 'Lux',
                data: []
            };
            $scope.drewpointChart = {
                series: 'Drewpoint',
                data: []
            };
            $scope.humidityChart = {
                series: 'Humidity',
                data: []
            };
            $scope.tempChart = {
                series: 'Temp',
                data: []
            };
            $scope.soilChart = {
                series: 'Soil',
                data: []
            };
            $scope.barChart = {
                series: 'Bar',
                data: []
            };

            jQuery.each(query.measurements, function(index, measurement) {
                $scope.luxChart.data.push({
                    x: measurement.created_at,
                    y: measurement.lux
                });
                $scope.drewpointChart.data.push({
                    x: measurement.created_at,
                    y: measurement.drewpoint
                });
                $scope.humidityChart.data.push({
                    x: measurement.created_at,
                    y: measurement.humidity
                });
                $scope.tempChart.data.push({
                    x: measurement.created_at,
                    y: measurement.temp
                });
                $scope.soilChart.data.push({
                    x: measurement.created_at,
                    y: measurement.soil
                });
                $scope.barChart.data.push({
                    x: measurement.created_at,
                    y: measurement.bar
                });
            });

            return
        };

        $scope.enableHistogram = function() {
            $scope.measurementToChartData($scope.measurementData)
            $scope.onClick = function(points, evt) {
                console.log(points, evt);
            };
            $scope.datasetOverride = [{
                yAxisID: 'y-axis-1'
            }, {
                yAxisID: 'y-axis-2'
            }];
            $scope.options = {
                scales: {
                    xAxes: [{
                        type: 'time',
                        time: {
                            displayFormats: {
                                quarter: 'MMM YYYY'
                            }
                        }
                    }],
                    yAxes: [{
                        id: 'y-axis-1',
                        type: 'linear',
                        display: true,
                        position: 'left'
                    }, {
                        id: 'y-axis-2',
                        type: 'linear',
                        display: true,
                        position: 'right'
                    }]
                }
            };
            $scope.histogram = true;
        };

    });
</script>
</head>

<body ng-controller="HistogramCtrl">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 col-md-2 sidebar">
                <ul class="nav nav-sidebar">
                    <li><a href="#">Greenhouse</a></li>
                </ul>
            </div>

            <span ng-show="histogram">
            <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
                <!-- series: ['Lux', 'Drewpoint', 'Humidity', 'Temp', 'Soil', 'Bar'],-->
                <div class="panel panel-default">
                    <div class="panel-heading">Lux</div>
                    <div class="panel-body">
                        <canvas id="line" class="chart chart-line" 
                        chart-data="luxChart.data"  
                        chart-series="luxChart.series" 
                        chart-options="options" 
                        chart-dataset-override="datasetOverride" 
                        chart-click="onClick"></canvas>
                    </div>
                </div>  
                 <div class="panel panel-default">
                    <div class="panel-heading">Drewpoint</div>
                    <div class="panel-body">
                        <canvas id="line" class="chart chart-line" 
                        chart-data="drewpointChart.data"  
                        chart-series="drewpointChart.series" 
                        chart-options="options" 
                        chart-dataset-override="datasetOverride" 
                        chart-click="onClick"></canvas>
                    </div>
                </div>    
                 <div class="panel panel-default">
                    <div class="panel-heading">Humidity</div>
                    <div class="panel-body">
                        <canvas id="line" class="chart chart-line" 
                        chart-data="humidityChart.data"  
                        chart-series="humidityChart.series" 
                        chart-options="options" 
                        chart-dataset-override="datasetOverride" 
                        chart-click="onClick"></canvas>
                    </div>
                </div>     
                 <div class="panel panel-default">
                    <div class="panel-heading">Temp</div>
                    <div class="panel-body">
                        <canvas id="line" class="chart chart-line" 
                        chart-data="tempChart.data"  
                        chart-series="tempChart.series" 
                        chart-options="options" 
                        chart-dataset-override="datasetOverride" 
                        chart-click="onClick"></canvas>
                    </div>
                </div>     
                 <div class="panel panel-default">
                    <div class="panel-heading">Soil</div>
                    <div class="panel-body">
                        <canvas id="line" class="chart chart-line" 
                        chart-data="soilChart.data"  
                        chart-series="soilChart.series" 
                        chart-options="options" 
                        chart-dataset-override="datasetOverride" 
                        chart-click="onClick"></canvas>
                    </div>
                </div>        
                 <div class="panel panel-default">
                    <div class="panel-heading">Bar</div>
                    <div class="panel-body">
                        <canvas id="line" class="chart chart-line" 
                        chart-data="barChart.data"  
                        chart-series="barChart.series" 
                        chart-options="options" 
                        chart-dataset-override="datasetOverride" 
                        chart-click="onClick"></canvas>
                    </div>
                </div>                      
          
            </div>
        </div>
    </div>
</body>

</html>